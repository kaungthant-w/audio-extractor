<!DOCTYPE html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>AI Music Transformer</title><link href=style.css rel=stylesheet><script src=https://code.jquery.com/jquery-3.6.0.min.js></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css></head><body class="min-h-screen flex flex-col items-center justify-center p-4 transition-colors duration-300"><button onclick=toggleTheme() class=theme-toggle><i id=themeIcon class="fa-solid fa-sun"></i></button><div class="neu-flat max-w-5xl w-full p-8 md:p-12 relative overflow-hidden"><div class="text-center mb-10"><h1 class="text-4xl font-bold mb-2 text-content tracking-tight"><i class="fa-solid fa-music text-purple-600 mr-2" style=color:var(--accent)></i>AI Music Transformer</h1><p class="text-sub font-medium">Transform your audio with AI separation & synthesis</p></div><div class="flex justify-center mb-8 gap-6"><button onclick='switchTab("upload")' id=tab-upload class="neu-btn active px-8 py-3"><i class="fa-solid fa-cloud-arrow-up mr-2"></i> Upload</button> <button onclick='switchTab("record")' id=tab-record class="neu-btn px-8 py-3"><i class="fa-solid fa-microphone mr-2"></i> Record</button></div><div class="grid grid-cols-1 md:grid-cols-2 gap-10"><div class=space-y-8><div id=upload-section><div class=mb-6><label class="block text-sm font-bold text-content mb-2 ml-1"><i class="fa-regular fa-folder-open mr-2"></i>Select Previously Uploaded</label> <select id=existingFiles class=neu-input><option value="">-- Upload New File Below --</option></select></div><div class="flex items-center justify-between my-4 text-sub text-sm font-medium"><span class="h-px w-full bg-gray-400 opacity-30 block"></span> <span class=px-4>OR</span> <span class="h-px w-full bg-gray-400 opacity-30 block"></span></div><label class="block text-sm font-bold text-content mb-2 ml-1">Upload New File</label><div class="flex items-center justify-center w-full"><label for=audioFile class="upload-area flex flex-col items-center justify-center w-full h-40 cursor-pointer"><div class="flex flex-col items-center justify-center pt-5 pb-6"><i class="fa-solid fa-cloud-arrow-up text-4xl text-sub mb-3"></i><p class="text-sm text-sub font-medium">Click to upload MP3 / WAV</p><p id=fileNameDisplay class="text-xs font-bold mt-2 hidden px-[20px] break-all" style=color:var(--accent)></p></div><input id=audioFile type=file class=hidden accept=audio/*></label></div></div><div id=record-section class="hidden text-center py-6"><div class="mb-6 h-24 flex items-center justify-center neu-pressed rounded-xl"><div id=visualizer class="flex gap-1 h-12 items-end"><div class="w-2 bg-purple-400 h-4 rounded-full"></div><div class="w-2 bg-purple-500 h-8 rounded-full"></div><div class="w-2 bg-purple-600 h-6 rounded-full"></div><div class="w-2 bg-purple-500 h-10 rounded-full"></div><div class="w-2 bg-purple-400 h-4 rounded-full"></div></div></div><button id=recordBtn class="w-20 h-20 rounded-full neu-btn flex items-center justify-center mx-auto text-red-500 hover:text-red-600 transition"><i class="fa-solid fa-microphone text-3xl"></i></button><p id=recordStatus class="mt-4 text-sub font-medium">Tap to Record</p><audio id=recordedAudioPreview controls class="w-full mt-6 hidden shadow-none"></audio></div><div><label class="block text-sm font-bold text-content mb-2 ml-1">Target Instrument</label> <select id=instrumentSelect class=neu-input><option value=flute>ðŸŽµ Synthesize Flute (New)</option><option value=split_flute>ðŸŽµ Only Split Flute (Isolate)</option><option value=vocals_only>ðŸŽ¤ Original Vocals Only</option><option value=pianet>ðŸŽ¹ Pianet</option><option value=vintage_organ>ðŸŽ¹ Vintage Organ</option><option value=cello>ðŸŽ» Cello</option><option value=guitar>ðŸŽ¸ Nylon Guitar</option><option value=saxophone>ðŸŽ· Saxophone</option><option value=mix_only>ðŸŽ¤ Mix Only (No Change)</option></select></div><div id=mixComponentsPanel class="neu-flat p-6 rounded-2xl"><label class="block text-sm font-bold text-content mb-4"><i class="fa-solid fa-sliders mr-2" style=color:var(--accent)></i>Mix Components</label><div class="flex flex-col space-y-4"><label class="flex items-center cursor-pointer text-content font-medium text-sm"><input type=checkbox id=mix_vocal value=vocal checked=checked class=mr-3> Original Vocals</label> <label class="flex items-center cursor-pointer text-content font-medium text-sm"><input type=checkbox id=mix_music value=music class=mr-3> Background Music</label> <label class="flex items-center cursor-pointer text-content font-medium text-sm"><input type=checkbox id=mix_inst value=instrument checked=checked class=mr-3> Generated Instrument</label></div><div class="mt-4 pt-4 border-t border-gray-400/20 hidden" id=mix_balance_wrapper><span class="text-xs font-bold text-sub mb-2 block">Mixing Balance</span><div class="flex items-center gap-2 text-[10px] font-bold text-sub"><span class="w-8 text-right">Vocals</span> <input type=range id=mix_balance min=0 max=100 value=50 class=flex-1> <span class=w-8>Inst</span></div><div class="text-center text-[10px] font-bold mt-1" id=mix_balance_display style=color:var(--accent)>Balanced (50/50)</div></div></div></div><div class="flex flex-col justify-between space-y-8"><div id=effectsPanel class="neu-flat p-6 rounded-2xl"><label class="block text-sm font-bold text-content mb-4"><i class="fa-solid fa-wand-magic-sparkles mr-2" style=color:var(--accent)></i>Effects & Clean Up</label><div class="grid grid-cols-2 gap-4 mb-5"><div><span class="text-xs font-bold text-sub mb-1 block ml-1">Auto EQ</span> <select id=effect_eq class="neu-input text-sm py-2"><option value=balanced>Balanced</option><option value=warm>Warm</option><option value=bright>Bright</option><option value=match_input>Match Input</option></select></div><div class="flex items-end pb-2"><label class="flex items-center cursor-pointer text-content font-medium text-sm"><input type=checkbox id=effect_vibrato checked=checked class=mr-2> Vibrato</label></div></div><div class=mb-6><div class="flex justify-between text-xs font-bold text-sub mb-2 px-1"><span>Effect Strength</span> <span id=strengthValue style=color:var(--accent)>50%</span></div><input type=range id=effect_strength min=1 max=100 value=50 class=w-full></div><div class="border-t border-gray-400/20 pt-4"><span class="text-xs font-bold text-sub mb-3 block ml-1">Input Cleanup</span><div class="flex gap-4"><label class="flex items-center cursor-pointer text-content font-medium text-xs"><input type=checkbox id=cleanup_reverb class=mr-2> Remove Reverb</label> <label class="flex items-center cursor-pointer text-content font-medium text-xs"><input type=checkbox id=cleanup_harmonies class=mr-2> Smooth Pitch</label></div></div><div id=flute_advanced_panel class="mt-4 pt-4 border-t border-gray-400/20 hidden"><span class="text-xs font-bold font-medium mb-3 block" style=color:var(--accent)>Flute Articulation Tuning</span><div class=space-y-4><div><div class="flex justify-between text-[10px] font-bold text-sub mb-1"><span>Note Sharpness (ms)</span> <span id=glitchVal>80ms</span></div><input type=range id=param_glitch min=20 max=200 value=80 class=w-full></div><div><div class="flex justify-between text-[10px] font-bold text-sub mb-1"><span>Articulation Clarity</span> <span id=sigmaVal>15</span></div><input type=range id=param_sigma min=2 max=50 value=15 class=w-full></div></div></div></div><div class="flex-grow flex flex-col justify-end"><div class="neu-pressed p-6 rounded-2xl mb-6 min-h-[160px] flex flex-col justify-center"><div id=idleState class=text-center><i class="fa-solid fa-wave-square text-4xl text-sub opacity-50 mb-3"></i><p class="text-sub text-sm">Ready to process audio</p></div><div id=loadingState class="hidden text-center"><div class="animate-spin rounded-full h-12 w-12 border-4 border-gray-300 border-t-purple-500 mx-auto mb-4"></div><p id=loadingMessage class="font-semibold text-sm animate-pulse" style=color:var(--accent)>Analyzing Audio...</p></div><div id=resultSection class="hidden text-center"><div class="w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3 shadow-inner bg-green-100/10"><i class="fa-solid fa-check text-green-500 text-xl"></i></div><h4 class="text-content font-bold mb-3">Processing Complete!</h4><audio id=finalAudio controls class="w-full h-8 mb-3"></audio><a id=downloadLink href=# class="text-xs font-bold hover:opacity-80 uppercase tracking-wider" style=color:var(--accent)><i class="fa-solid fa-download mr-1"></i> Download File</a></div></div><div class="flex gap-4 w-full"><button id=previewBtn class="neu-btn w-1/3 py-4 text-lg font-bold tracking-wide uppercase flex items-center justify-center gap-2 text-sub hover:text-content transition-colors"><i class="fa-solid fa-play"></i> Test</button> <button id=processBtn class="neu-btn-primary flex-1 py-4 text-lg font-bold tracking-wide uppercase flex items-center justify-center gap-3"><i class="fa-solid fa-wand-magic-sparkles"></i> Process Audio</button></div></div></div></div></div><script>let mediaRecorder,audioBlob=null,audioChunks=[],isRecording=!1;function toggleTheme(){const e=document.documentElement;"light"===e.getAttribute("data-theme")?(e.setAttribute("data-theme","dark"),$("#themeIcon").removeClass("fa-moon").addClass("fa-sun"),localStorage.setItem("theme","dark")):(e.setAttribute("data-theme","light"),$("#themeIcon").removeClass("fa-sun").addClass("fa-moon"),localStorage.setItem("theme","light"))}function refreshFileList(){$.get("process.php?action=list_files",function(e){const t="object"==typeof e?e:JSON.parse(e);"success"===t.status&&($("#existingFiles").html('<option value="">-- Upload New File Below --</option>'),t.files.forEach(e=>{$("#existingFiles").append(`<option value="${e}">${e}</option>`)}),createCustomSelect("existingFiles"))})}function updateMixBalanceUI(){const e=$("#mix_vocal").is(":checked"),t=$("#mix_inst").is(":checked");e&&t?$("#mix_balance_wrapper").removeClass("hidden"):$("#mix_balance_wrapper").addClass("hidden")}function startProcessing(e){const t=$("#existingFiles").val();if(!audioBlob&&!t)return void alert("Please select a file or record audio first.");let a=[];if($("#mix_vocal").is(":checked")&&a.push("vocal"),$("#mix_music").is(":checked")&&a.push("music"),$("#mix_inst").is(":checked")&&a.push("instrument"),0===a.length)return void alert("Please select at least one mix component.");let s={eq:$("#effect_eq").val(),vibrato:$("#effect_vibrato").is(":checked"),strength:$("#effect_strength").val(),cleanup_reverb:$("#cleanup_reverb").is(":checked"),cleanup_harmonies:$("#cleanup_harmonies").is(":checked"),glitch_threshold:$("#param_glitch").val()/1e3,amp_smoothing:$("#param_sigma").val(),pitch_smoothing:5,reverb_amount:.12,preview:e,mix_balance:$("#mix_balance").val()/100},i=new FormData;t?i.append("existing_file",t):audioBlob instanceof File?i.append("audio",audioBlob,audioBlob.name):i.append("audio",audioBlob,"recording.wav"),i.append("instrument",$("#instrumentSelect").val()),i.append("mix_options",a.join(",")),i.append("effects_options",JSON.stringify(s)),$("#idleState").addClass("hidden"),$("#resultSection").addClass("hidden"),$("#loadingState").removeClass("hidden"),$("#processBtn, #previewBtn").addClass("opacity-50 cursor-not-allowed").prop("disabled",!0),e&&$("#loadingMessage").text("Generating Preview..."),$.ajax({url:"process.php",type:"POST",data:i,processData:!1,contentType:!1,timeout:6e4,success:function(e){const t="object"==typeof e?e:JSON.parse(e);"started"===t.status?pollForResult(t.job_id):(alert("Error: "+t.message),resetUI())},error:function(e){alert("Upload failed."),console.error(e),resetUI()}})}function pollForResult(e){let t=0;const a=["Separating Vocals...","Analyzing Pitch...","Synthesizing Instrument...","Mixing Tracks...","Finalizing..."],s=setInterval(()=>{if(t++,$("#loadingMessage").text(a[Math.min(Math.floor(t/8),4)]),t>=200)return clearInterval(s),alert("Timeout."),void resetUI();$.ajax({url:`process.php?action=check&job_id=${e}`,type:"GET",success:function(e){const t="object"==typeof e?e:JSON.parse(e);"success"===t.status?(clearInterval(s),$("#finalAudio").attr("src",t.url),$("#downloadLink").attr("href",t.url),$("#loadingState").addClass("hidden"),$("#resultSection").removeClass("hidden"),$("#processBtn, #previewBtn").removeClass("opacity-50 cursor-not-allowed").prop("disabled",!1),refreshFileList()):"error"===t.status&&(clearInterval(s),alert("Error: "+t.message),resetUI())}})},3e3)}function resetUI(){$("#loadingState").addClass("hidden"),$("#idleState").removeClass("hidden"),$("#processBtn, #previewBtn").removeClass("opacity-50 cursor-not-allowed").prop("disabled",!1)}function createCustomSelect(e){const t=$("#"+e);if(!t.length)return;t.parent().hasClass("custom-select-wrapper")&&(t.siblings(".custom-select").remove(),t.unwrap()),t.wrap('<div class="custom-select-wrapper"></div>'),t.hide();const a=t.parent(),s=t.find(":selected"),i=s.length?s.text():t.find("option").first().text(),o=$('<div class="custom-select"></div>'),n=$(`\n\t\t\t\t<div class="custom-select-trigger">\n\t\t\t\t\t<span>${i}</span>\n\t\t\t\t\t<i class="fa-solid fa-chevron-down select-icon"></i>\n\t\t\t\t</div>\n\t\t\t`),l=$('<div class="custom-options"></div>');t.find("option").each(function(){const t=$(this),a=t.is(":selected"),s=t.val();let i="";"existingFiles"===e&&""!==s&&(i='<i class="fa-solid fa-trash text-red-400 hover:text-red-500 p-2 z-50 delete-file-btn" title="Delete File"></i>'),l.append(`\n\t\t\t\t\t<div class="custom-option ${a?"selected":""}" data-value="${s}">\n\t\t\t\t\t\t<span class="truncate pr-2">${t.text()}</span>\n\t\t\t\t\t\t${i}\n\t\t\t\t\t</div>\n\t\t\t\t`)}),o.append(n),o.append(l),a.append(o),n.on("click",function(e){e.stopPropagation(),$(".custom-select").not(o).removeClass("open"),o.toggleClass("open")}),l.on("click",".custom-option",function(e){e.stopPropagation();const a=$(this).data("value"),s=$(this).find("span").first().text().trim();t.val(a).trigger("change"),n.find("span").text(s),l.find(".custom-option").removeClass("selected"),$(this).addClass("selected"),o.removeClass("open")}),l.on("click",".delete-file-btn",function(e){if(e.stopPropagation(),!confirm("Are you sure you want to delete this file?"))return;const t=$(this).closest(".custom-option").data("value");$.post("process.php?action=delete_file",{file:t},function(e){refreshFileList(),o.removeClass("open"),$("#fileNameDisplay").addClass("hidden"),$("#audioFile").val("")})})}$(document).ready(function(){const e=localStorage.getItem("theme")||"dark";document.documentElement.setAttribute("data-theme",e),"light"===e?$("#themeIcon").removeClass("fa-sun").addClass("fa-moon"):$("#themeIcon").removeClass("fa-moon").addClass("fa-sun"),createCustomSelect("instrumentSelect"),createCustomSelect("effect_eq"),$("#effect_strength").on("input",function(){$("#strengthValue").text($(this).val()+"%")}),refreshFileList()}),$("#existingFiles").on("change",function(){$(this).val()&&($("#audioFile").val(""),$("#fileNameDisplay").text("Using: "+$(this).val()).removeClass("hidden"),audioBlob=null)}),$("#audioFile").on("change",function(e){if(e.target.files.length>0){let t=e.target.files[0].name;$("#fileNameDisplay").text(t).removeClass("hidden"),audioBlob=e.target.files[0],$("#existingFiles").val("")}}),window.switchTab=function(e){"upload"===e?($("#upload-section").removeClass("hidden"),$("#record-section").addClass("hidden"),$("#tab-upload").addClass("active").removeClass("text-sub"),$("#tab-record").removeClass("active").addClass("text-sub")):($("#upload-section").addClass("hidden"),$("#record-section").removeClass("hidden"),$("#tab-upload").removeClass("active").addClass("text-sub"),$("#tab-record").addClass("active").removeClass("text-sub"))},$("#recordBtn").on("click",async function(){if(isRecording)mediaRecorder.stop(),isRecording=!1,$(this).removeClass("pulse-record !text-red-600"),$("#recordStatus").text("Tap to Record");else try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});mediaRecorder=new MediaRecorder(e),audioChunks=[],mediaRecorder.ondataavailable=e=>audioChunks.push(e.data),mediaRecorder.onstop=()=>{audioBlob=new Blob(audioChunks,{type:"audio/wav"});const e=URL.createObjectURL(audioBlob);$("#recordedAudioPreview").attr("src",e).removeClass("hidden"),$("#fileNameDisplay").text("Recorded Audio").removeClass("hidden"),$("#existingFiles").val("")},mediaRecorder.start(),isRecording=!0,$(this).addClass("pulse-record !text-red-600"),$("#recordStatus").text("Recording... (Tap to Stop)")}catch(e){alert("Microphone access denied.")}}),$("#instrumentSelect").on("change",function(){const e=$(this).val();"flute"===e?$("#flute_advanced_panel").removeClass("hidden"):$("#flute_advanced_panel").addClass("hidden"),"split_flute"===e?($("#effectsPanel").addClass("opacity-50 pointer-events-none").find("input, select").prop("disabled",!0),$("#mixComponentsPanel").addClass("opacity-50 pointer-events-none"),$("#mix_vocal").prop("checked",!1),$("#mix_music").prop("checked",!1),$("#mix_inst").prop("checked",!0),updateMixBalanceUI()):"vocals_only"===e?($("#effectsPanel").addClass("opacity-50 pointer-events-none").find("input, select").prop("disabled",!0),$("#mixComponentsPanel").addClass("opacity-50 pointer-events-none"),$("#mix_vocal").prop("checked",!0),$("#mix_music").prop("checked",!1),$("#mix_inst").prop("checked",!1),updateMixBalanceUI()):($("#effectsPanel").removeClass("opacity-50 pointer-events-none").find("input, select").prop("disabled",!1),$("#mixComponentsPanel").removeClass("opacity-50 pointer-events-none"),$("#mix_vocal").prop("checked",!0),$("#mix_inst").prop("checked",!0),updateMixBalanceUI())}),$("#param_glitch").on("input",function(){$("#glitchVal").text($(this).val()+"ms")}),$("#param_sigma").on("input",function(){$("#sigmaVal").text($(this).val())}),$("#mix_vocal, #mix_inst").on("change",updateMixBalanceUI),$("#mix_balance").on("input",function(){const e=parseInt($(this).val());let t="Balanced";e<45?t=`Vocals +${2*(50-e)}%`:e>55&&(t=`Inst +${2*(e-50)}%`),$("#mix_balance_display").text(t)}),$(document).ready(function(){updateMixBalanceUI()}),$("#processBtn").on("click",function(){startProcessing(!1)}),$("#previewBtn").on("click",function(){startProcessing(!0)}),$(document).on("click",function(e){$(e.target).closest(".custom-select-wrapper").length||$(".custom-select").removeClass("open")})</script></body></html>